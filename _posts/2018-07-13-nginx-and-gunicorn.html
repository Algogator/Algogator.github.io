---
layout: post
title: Nginx and Gunicorn
date: 2018-07-13 07:17:34.000000000 -05:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- backend
tags: []
permalink: "/nginx-and-gunicorn/"
---
<h6>What is gunicorn?</h6>
<p>Guincorn or Green Unicorn is a HTTP Server which supports WSGI (WSGI are a bunch rules that allow a web framework, in this case Django, to talk with the server). Django by default generates a WSGI config for your project <strong>wsgi.py</strong>, and from the comments "It should expose a module-level variable named ``application``. " Keep this in mind for later. Gunicorn is an app server. Its primary job is to work with the web application and serve up "processed" data to web servers and sometimes other app servers. Based on the pre-forker model, there is a master process which manages the workers who handle all the requests and responses.</p>
<h6>What is Nginx?</h6>
<p>Nginx is a web server. Its primary job is to serve the static content from a web application (HTML, images, videos etc.) to us (browsers or mobile applications). As a reverse proxy server, it's the public face for the application, it can direct requests from the browsers to the appropriate backend server (Gunicorn). Nginx handles load balancing, web acceleration and security.</p>
<h6>Why do we need guincorn OR NGINX?</h6>
<p>The Django server by itself is great for development but wouldn't survive in production. It's not meant to handle a lot of traffic. That's where Guincorn and Nginx come in. While we could Guincorn to run the web application, create workers and sockets, server static content, Ngnix just does a better job of handling the stress of the web as a reverse proxy. Gunicorn recommends having a proxy server in front of it (and Nginx is strongly preferred).</p>
<p>If your application is a fancy upscale restaurant, Ngnix would be the dedicated expeditor and Gunicorn the Chef who directs the rest of the kitchen in this case your Django applications.</p>
<h6>Setting up Gunicorn</h6>
<p><code>pip install gunicorn</code></p>
<p>Gunicorn requires an application object, remember the wsgi.py generated by Django and a socket file to communicate with Nginx (the socket file is automatically created the first time the application is run with Gunicorn). You can also specify the number and type of workers you want.</p>
<p><code>gunicorn --workers 3 --bind unix:myproject.sock wsgi:app</code></p>
<h6>Setting up Nginx</h6>
<p>The default welcome site you see is at /usr/share/nginx/html</p>
<p>It's specified in the default server block configuration file /etc/nginx/nginx.conf</p>
<p>A server block to used to receive requests from a particular domain and port. A location block is defined in a server block and can be used to match the request URI. The bare minimum to set up Gunicorn with Nginx is this:</p>
<pre>  server {
    listen 80;
    server_name example.org;
    access_log  /var/log/nginx/example.log;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
</pre>
<p>Here a server block has been defined for example.org which listens to requests from port 80 and passes it on to the proxied server http://127.0.0.1:8000. But in our case the proxied server is the socket at myproject.sock (http://unix:/home/user/myproject/myproject.sock;)</p>
<h6>References</h6>
<p><a href="https://www.nginx.com/resources/glossary/application-server-vs-web-server/">https://www.nginx.com/resources/glossary/application-server-vs-web-server/</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/django-server-comparison-the-development-server-mod_wsgi-uwsgi-and-gunicorn">https://www.digitalocean.com/community/tutorials/django-server-comparison-the-development-server-mod_wsgi-uwsgi-and-gunicorn</a></p>
<p><a href="https://serverfault.com/questions/331256/why-do-i-need-nginx-and-something-like-gunicorn">https://serverfault.com/questions/331256/why-do-i-need-nginx-and-something-like-gunicorn</a></p>
<p><a href="http://docs.gunicorn.org/en/stable/design.html">http://docs.gunicorn.org/en/stable/design.html</a></p>
